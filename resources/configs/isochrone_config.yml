# Isochrone Generation Configuration
# Configuration for OSRM routing and trade area isochrone generation
# Version: 2.1 (OSRM-based with Urbanicity Support)
# Last Updated: 2025-11-14

# OSRM Configuration
osrm:
  # OSRM HTTP endpoint URL
  # Replace with your OSRM server URL after deployment
  # Examples:
  #   - Local development: "http://localhost:5000"
  #   - Azure VM: "http://your-vm-ip:5000"
  #   - Load balancer: "http://osrm-lb.internal:5000"
  endpoint_url: "http://localhost:5000"

  # Routing profile (vehicle type)
  # Options: driving, walking, cycling
  profile: "driving"

  # HTTP request timeout in seconds
  timeout_seconds: 30

# Isochrone Generation Configuration
isochrone:
  # Drive time buckets in minutes
  drive_time_buckets: [5, 10, 15, 20, 30]

  # Input location tables
  input_tables:
    rmc: "retail_consumer_goods.geospatial_site_selection.rmc_retail_locations_grocery"
    competitors: "retail_consumer_goods.geospatial_site_selection.competitor_locations"

  # Output table names (will be created in Silver schema)
  output_tables:
    rmc: "rmc_retail_locations_grocery_isochrones"
    competitors: "competitor_locations_isochrones"

# Urbanicity-Based Routing Configuration
# Dynamically assigns drive times based on urbanicity category from h3_features_gold
urbanicity_routing:
  # Enable urbanicity-based routing (set to false to use standard drive_time_buckets)
  enabled: true

  # H3 features table containing urbanicity_category
  h3_features_table: "retail_consumer_goods.geospatial_site_selection.silver_h3_features"

  # Drive time in minutes for each urbanicity category
  # Categories: urban, suburban, rural (from h3_features_gold.urbanicity_category)
  drive_times:
    urban: 5       # Urban areas: 10 minute trade areas
    suburban: 5    # Suburban areas: 20 minute trade areas
    rural: 5       # Rural areas: 30 minute trade areas
    default: 5     # Default drive time if urbanicity cannot be determined

  # Output table for urbanicity-based isochrones
  output_table: "rmc_urbanicity_based_isochrones"

# Performance Configuration
performance:
  # Repartition factor for distributed processing
  # Actual partitions = sc.defaultParallelism * repartition_factor
  # Higher values = more parallelism but more HTTP connections to OSRM
  repartition_factor: 8

# Output Schema Configuration
output:
  write_mode: "overwrite"
  include_area: true  # Calculate and include area_sqkm
  include_metadata: true  # Include created_timestamp
  include_urbanicity_info: true  # Include urbanicity_score and urbanicity_category in output
